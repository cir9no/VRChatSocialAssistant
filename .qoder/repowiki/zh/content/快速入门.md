# å¿«é€Ÿå…¥é—¨

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [setup_and_test.bat](file://setup_and_test.bat)
- [requirements.txt](file://requirements.txt)
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py)
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py)
- [src/audio_capture/device_manager.py](file://src/audio_capture/device_manager.py)
- [config/audio_config.yaml](file://config/audio_config.yaml)
- [README.md](file://README.md)
- [doc/æ¶æ„è®¾è®¡.md](file://doc/æ¶æ„è®¾è®¡.md)
- [src/memory/README.md](file://src/memory/README.md)
</cite>

## ç›®å½•
1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [ä¸€é”®å®‰è£…è„šæœ¬](#ä¸€é”®å®‰è£…è„šæœ¬)
4. [é¦–æ¬¡è¿è¡ŒæŒ‡å—](#é¦–æ¬¡è¿è¡ŒæŒ‡å—)
5. [éŸ³é¢‘é‡‡é›†æµ‹è¯•](#éŸ³é¢‘é‡‡é›†æµ‹è¯•)
6. [æµ‹è¯•è¾“å‡ºè§£æ](#æµ‹è¯•è¾“å‡ºè§£æ)
7. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
8. [æƒé™è¦æ±‚è¯¦è§£](#æƒé™è¦æ±‚è¯¦è§£)
9. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
10. [æ€»ç»“](#æ€»ç»“)

## é¡¹ç›®ç®€ä»‹

VRChat ç¤¾äº¤åŠ©æ‰‹æ˜¯ä¸€ä¸ªåŸºäº AI çš„ VRChat ç¤¾äº¤è¾…åŠ©ç³»ç»Ÿï¼Œé€šè¿‡å®æ—¶è¯­éŸ³è¯†åˆ«ã€å£°çº¹è¯†åˆ«å’Œå¤§è¯­è¨€æ¨¡å‹ï¼Œä¸ºç”¨æˆ·æä¾›æ™ºèƒ½ç¤¾äº¤æç¤ºã€‚ç³»ç»Ÿé‡‡ç”¨éä¾µå…¥å¼è®¾è®¡ï¼Œä»…åœ¨ç”¨æˆ·å¤´æ˜¾ä¸­å±•ç¤ºè¾…åŠ©ä¿¡æ¯ï¼Œä¸ä¿®æ”¹ VRChat å®¢æˆ·ç«¯æˆ–å½±å“å…¶ä»–ç©å®¶ä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ¤ **å®æ—¶éŸ³é¢‘é‡‡é›†**ï¼šæ”¯æŒ WASAPI Loopback é‡‡é›†ç³»ç»ŸéŸ³é¢‘å’Œéº¦å…‹é£è¾“å…¥
- ğŸ—£ï¸ **è¯­éŸ³æ´»åŠ¨æ£€æµ‹ï¼ˆVADï¼‰**ï¼šåŸºäº Silero æ¨¡å‹çš„å®æ—¶è¯­éŸ³ç‰‡æ®µæ£€æµ‹
- ğŸ‘¤ **è¯´è¯äººè¯†åˆ«**ï¼šé€šè¿‡å£°çº¹è¯†åˆ«åŒºåˆ†ä¸åŒè¯´è¯äºº
- ğŸ“ **è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆSTTï¼‰**ï¼šå®æ—¶è¯­éŸ³è¯†åˆ«ï¼Œæ”¯æŒä¸­è‹±æ–‡æ··åˆ
- ğŸ§  **æ™ºèƒ½å¯¹è¯è¾…åŠ©**ï¼šåŸºäº LLM çš„ä¸Šä¸‹æ–‡ç†è§£å’Œå»ºè®®ç”Ÿæˆ
- ğŸ’¾ **è®°å¿†ç®¡ç†**ï¼šRAG å‘é‡æ£€ç´¢ï¼Œè®°ä½å¥½å‹ä¿¡æ¯å’Œå¯¹è¯å†å²
- ğŸ¥½ **VR æ˜¾ç¤º**ï¼šåŸºäº OpenXR çš„å¤´æ˜¾ HUD æç¤ºå±•ç¤º

### æŠ€æœ¯æ¶æ„
```mermaid
flowchart TD
A[VR å¤´æ˜¾ HUD æ˜¾ç¤º] --> B[æç¤ºç”Ÿæˆ & æ™ºèƒ½å»ºè®®æ¨¡å—]
B --> C[è¯­éŸ³å¤„ç†æ¨¡å—]
C --> D[éŸ³é¢‘é‡‡é›†æ¨¡å—]
```

**å›¾è¡¨æ¥æº**
- [README.md](file://README.md#L35-L57)

#### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VR å¤´æ˜¾ HUD æ˜¾ç¤º                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æç¤ºç”Ÿæˆ & æ™ºèƒ½å»ºè®®æ¨¡å—                      â”‚
â”‚  - LLMæ¨ç†å¼•æ“  - è®°å¿†æ£€ç´¢  - æç¤ºæ ¼å¼åŒ–                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¯­éŸ³å¤„ç†æ¨¡å—                           â”‚
â”‚  - VADæ£€æµ‹  - è¯´è¯äººè¯†åˆ«  - æµå¼STT                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   éŸ³é¢‘é‡‡é›†æ¨¡å—                           â”‚
â”‚  - WASAPI Loopback  - éº¦å…‹é£è¾“å…¥  - éŸ³é¢‘é¢„å¤„ç†           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾è¡¨æ¥æº**
- [README.md](file://README.md#L35-L57)

#### æ•°æ®æµå‘
1. **éŸ³é¢‘é‡‡é›†** â†’ ç³»ç»Ÿå›ç¯æŠ“å– VRChat æ‰¬å£°å™¨è¾“å‡º + æœ¬åœ°éº¦å…‹é£è¾“å…¥
2. **VAD æ£€æµ‹** â†’ åˆ‡åˆ†è¿ç»­è¯­éŸ³æµä¸º 0.5-1 ç§’è¯­éŸ³ç‰‡æ®µ
3. **è¯´è¯äººè¯†åˆ«** â†’ å¯¹æ¯ä¸ªè¯­éŸ³ç‰‡æ®µæå–å£°çº¹åµŒå…¥ï¼Œä¸å·²æ³¨å†Œå¥½å‹å¯¹æ¯”
4. **æµå¼ STT** â†’ é€šè¿‡é—¨æ§çš„è¯­éŸ³ç‰‡æ®µè¿›è¡Œå®æ—¶è¯­éŸ³è½¬æ–‡æœ¬
5. **ä¼šè¯ç†è§£** â†’ åˆ†æè¯†åˆ«æ–‡æœ¬ï¼Œæå–äº‹ä»¶ã€æƒ…ç»ªã€è¯é¢˜å˜åŒ–
6. **è®°å¿†æ£€ç´¢** â†’ æ ¹æ®å½“å‰ä¸Šä¸‹æ–‡ä»å‘é‡åº“æ£€ç´¢ç›¸å…³å¥½å‹ä¿¡æ¯
7. **LLM æ¨ç†** â†’ ç»“åˆä¸Šä¸‹æ–‡ä¸è®°å¿†ç”Ÿæˆç»“æ„åŒ–ç¤¾äº¤å»ºè®®
8. **æç¤ºç”Ÿæˆ** â†’ æ ¹æ®ä¼˜å…ˆçº§ã€å®‰å…¨ç­–ç•¥æ ¼å¼åŒ–å»ºè®®
9. **VR å±•ç¤º** â†’ åœ¨å¤´æ˜¾ Overlay ä¸­æ˜¾ç¤ºæç¤ºæ–‡æœ¬

**å›¾è¡¨æ¥æº**
- [doc/æ¶æ„è®¾è®¡.md](file://doc/æ¶æ„è®¾è®¡.md#L71-L81)

## ç¯å¢ƒå‡†å¤‡

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 10/11ï¼ˆWASAPI ç‰¹æ€§æ”¯æŒï¼‰
- **Python ç‰ˆæœ¬**ï¼šPython 3.8+ï¼ˆæ¨è 3.10+ï¼‰
- **ç®¡ç†å‘˜æƒé™**ï¼šé¦–æ¬¡è¿è¡Œéœ€è¦ç®¡ç†å‘˜æƒé™
- **éŸ³é¢‘é©±åŠ¨**ï¼šå®Œæ•´çš„éŸ³é¢‘é©±åŠ¨ç¨‹åº
- **GPU æ”¯æŒ**ï¼šæ”¯æŒ CUDA çš„ GPUï¼ˆå¯é€‰ï¼Œç”¨äºåŠ é€Ÿï¼‰

### å¿…éœ€è½¯ä»¶
1. **Python 3.8+**ï¼šä» python.org ä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆæœ¬
2. **Visual C++ Redistributable**ï¼šæŸäº›ä¾èµ–åº“éœ€è¦æ­¤ç»„ä»¶
3. **éŸ³é¢‘è®¾å¤‡**ï¼šè‡³å°‘ä¸€ä¸ªå¯ç”¨çš„éŸ³é¢‘è¾“å…¥/è¾“å‡ºè®¾å¤‡

### æŠ€æœ¯é€‰å‹
| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| éŸ³é¢‘å¤„ç† | PyAudio + pyaudiowpatch | WASAPI Loopback æ”¯æŒ |
| è¯­éŸ³æ£€æµ‹ | Silero VAD | è½»é‡çº§ã€é«˜ç²¾åº¦ VAD æ¨¡å‹ |
| è¯­éŸ³è¯†åˆ« | faster-whisper | æœ¬åœ°éƒ¨ç½²çš„é«˜æ•ˆ STT |
| å£°çº¹è¯†åˆ« | pyannote.audio | ECAPA-TDNN å£°çº¹æ¨¡å‹ |
| å‘é‡æ•°æ®åº“ | Chroma | è®°å¿†å­˜å‚¨å’Œæ£€ç´¢ |
| å¤§è¯­è¨€æ¨¡å‹ | OpenAI API / æœ¬åœ°æ¨¡å‹ | å¯¹è¯ç†è§£å’Œå»ºè®®ç”Ÿæˆ |
| VR æ¸²æŸ“ | OpenXR + pyopenvr | è·¨å¹³å° VR æ˜¾ç¤º |

**ç« èŠ‚æ¥æº**
- [README.md](file://README.md#L23-L31)

## ä¸€é”®å®‰è£…è„šæœ¬

é¡¹ç›®æä¾›äº† `setup_and_test.bat` æ‰¹å¤„ç†è„šæœ¬ï¼Œå®ç°ä¸€é”®ç¯å¢ƒé…ç½®å’Œæµ‹è¯•ï¼š

```mermaid
flowchart TD
Start([å¼€å§‹è¿è¡Œè„šæœ¬]) --> CheckPython["æ£€æŸ¥ Python ç¯å¢ƒ"]
CheckPython --> PythonOK{"Python å¯ç”¨ï¼Ÿ"}
PythonOK --> |å¦| PythonError["æ˜¾ç¤ºé”™è¯¯ï¼šæœªæ‰¾åˆ° Python"]
PythonOK --> |æ˜¯| InstallDeps["å®‰è£…ä¾èµ–åŒ…"]
InstallDeps --> DepsOK{"ä¾èµ–å®‰è£…æˆåŠŸï¼Ÿ"}
DepsOK --> |å¦| DepsError["æ˜¾ç¤ºé”™è¯¯ï¼šä¾èµ–å®‰è£…å¤±è´¥"]
DepsOK --> |æ˜¯| RunTest["è¿è¡ŒéŸ³é¢‘æµ‹è¯•"]
RunTest --> TestComplete["æµ‹è¯•å®Œæˆ"]
PythonError --> Pause["æš‚åœç­‰å¾…"]
DepsError --> Pause
TestComplete --> Pause
Pause --> End([ç»“æŸ])
```

**å›¾è¡¨æ¥æº**
- [setup_and_test.bat](file://setup_and_test.bat#L1-L34)

### è„šæœ¬æ‰§è¡Œæµç¨‹

1. **ç¯å¢ƒæ£€æŸ¥é˜¶æ®µ**ï¼ˆç¬¬8-14è¡Œï¼‰
   - éªŒè¯ Python æ˜¯å¦å·²å®‰è£…
   - æ£€æŸ¥ Python ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚
   - å¦‚æœªæ‰¾åˆ° Pythonï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡º

2. **ä¾èµ–å®‰è£…é˜¶æ®µ**ï¼ˆç¬¬17-23è¡Œï¼‰
   - è‡ªåŠ¨å®‰è£… `requirements.txt` ä¸­åˆ—å‡ºçš„ä¾èµ–åŒ…
   - åŒ…å«ï¼špyaudiowpatchã€numpyã€scipy
   - å¦‚å®‰è£…å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡º

3. **æµ‹è¯•æ‰§è¡Œé˜¶æ®µ**ï¼ˆç¬¬26-28è¡Œï¼‰
   - è¿è¡ŒéŸ³é¢‘é‡‡é›†æµ‹è¯•è„šæœ¬
   - è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®éŸ³é¢‘è®¾å¤‡
   - æ˜¾ç¤ºæµ‹è¯•ç»“æœå’Œç»Ÿè®¡ä¿¡æ¯

**ç« èŠ‚æ¥æº**
- [setup_and_test.bat](file://setup_and_test.bat#L1-L34)
- [requirements.txt](file://requirements.txt#L1-L4)

## é¦–æ¬¡è¿è¡ŒæŒ‡å—

### æ­¥éª¤1ï¼šä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ

1. **å³é”®ç‚¹å‡»** `setup_and_test.bat`
2. é€‰æ‹© **"ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"**
3. ç¡®ä¿è„šæœ¬å…·æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®ç³»ç»ŸéŸ³é¢‘è®¾å¤‡

### æ­¥éª¤2ï¼šç­‰å¾…è„šæœ¬æ‰§è¡Œ

è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š
- Python ç¯å¢ƒæ£€æŸ¥
- ä¾èµ–åŒ…å®‰è£…è¿›åº¦
- éŸ³é¢‘è®¾å¤‡æ£€æµ‹
- æµ‹è¯•æ‰§è¡ŒçŠ¶æ€

### æ­¥éª¤3ï¼šè§‚å¯Ÿæ§åˆ¶å°è¾“å‡º

é‡ç‚¹å…³æ³¨ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
- è®¾å¤‡åˆ—è¡¨æ˜¾ç¤º
- æµ‹è¯•å¼€å§‹æç¤º
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- ç»Ÿè®¡ä¿¡æ¯è¾“å‡º

**ç« èŠ‚æ¥æº**
- [setup_and_test.bat](file://setup_and_test.bat#L1-L34)

## éŸ³é¢‘é‡‡é›†æµ‹è¯•

### æµ‹è¯•è„šæœ¬åŠŸèƒ½

æµ‹è¯•è„šæœ¬ `test_audio_capture.py` æä¾›äº†å®Œæ•´çš„éŸ³é¢‘é‡‡é›†åŠŸèƒ½éªŒè¯ï¼š

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant Script as æµ‹è¯•è„šæœ¬
participant DeviceMgr as è®¾å¤‡ç®¡ç†å™¨
participant Capturer as éŸ³é¢‘é‡‡é›†å™¨
participant AudioDev as éŸ³é¢‘è®¾å¤‡
User->>Script : è¿è¡Œæµ‹è¯•
Script->>DeviceMgr : æ£€æµ‹éŸ³é¢‘è®¾å¤‡
DeviceMgr->>AudioDev : æ‰«æç³»ç»Ÿè®¾å¤‡
AudioDev-->>DeviceMgr : è¿”å›è®¾å¤‡åˆ—è¡¨
DeviceMgr-->>Script : è®¾å¤‡ä¿¡æ¯
Script->>User : æ˜¾ç¤ºè®¾å¤‡é€‰é¡¹
User->>Script : é€‰æ‹©è®¾å¤‡
Script->>Capturer : åˆ›å»ºé‡‡é›†å™¨
Capturer->>AudioDev : å¯åŠ¨éŸ³é¢‘æµ
AudioDev-->>Capturer : éŸ³é¢‘æ•°æ®
Capturer-->>Script : å¤„ç†éŸ³é¢‘æ•°æ®
Script-->>User : æ˜¾ç¤ºæµ‹è¯•ç»“æœ
```

**å›¾è¡¨æ¥æº**
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py#L193-L213)
- [src/audio_capture/device_manager.py](file://src/audio_capture/device_manager.py#L14-L21)
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py#L19-L80)

### è®¾å¤‡é€‰æ‹©æµç¨‹

1. **è®¾å¤‡åˆ—è¡¨æ˜¾ç¤º**
   - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„éŸ³é¢‘è®¾å¤‡
   - åŒºåˆ†è¾“å…¥è®¾å¤‡ï¼ˆéº¦å…‹é£ï¼‰å’Œè¾“å‡ºè®¾å¤‡ï¼ˆæ‰¬å£°å™¨ï¼‰
   - æ ‡è¯† WASAPI Loopback è®¾å¤‡

2. **è®¾å¤‡é€‰æ‹©ç•Œé¢**
   ```
   è¯·é€‰æ‹©è¦ä½¿ç”¨çš„è®¾å¤‡ï¼š
   
   WASAPI Loopback è®¾å¤‡ï¼ˆç³»ç»ŸéŸ³é¢‘ï¼‰ï¼š
     1. [0] éŸ³é¢‘é€‚é…å™¨ (Realtek High Definition Audio)
   
   éº¦å…‹é£è®¾å¤‡ï¼š
     1. [1] éº¦å…‹é£ (Realtek High Definition Audio)
   
   é€‰æ‹© WASAPI Loopback è®¾å¤‡ (1-1, é»˜è®¤ 1, æˆ–æŒ‰å›è½¦è·³è¿‡): 
   ```

3. **é»˜è®¤è®¾å¤‡æ¨è**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æ¨èé»˜è®¤è®¾å¤‡
   - æŒ‰å›è½¦å¯ç›´æ¥ä½¿ç”¨é»˜è®¤è®¾å¤‡
   - æ”¯æŒæ‰‹åŠ¨é€‰æ‹©ç‰¹å®šè®¾å¤‡

### æµ‹è¯•å‚æ•°é…ç½®

æ ¹æ® `audio_config.yaml` é…ç½®ï¼Œæµ‹è¯•ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼š
- **é‡‡æ ·ç‡**ï¼š16000 Hzï¼ˆSTT æ ‡å‡†ï¼‰
- **å£°é“æ•°**ï¼š1ï¼ˆå•å£°é“ï¼‰
- **ç¼“å†²åŒºå¤§å°**ï¼š480 æ ·æœ¬ï¼ˆ30ms @ 16kHzï¼‰
- **æµ‹è¯•æ—¶é•¿**ï¼š10 ç§’

**ç« èŠ‚æ¥æº**
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py#L58-L208)
- [config/audio_config.yaml](file://config/audio_config.yaml#L1-L32)

## æµ‹è¯•è¾“å‡ºè§£æ

### å…³é”®è¾“å‡ºä¿¡æ¯

æµ‹è¯•å®Œæˆåï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºè¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯å’Œæµ‹è¯•ç»“æœï¼š

#### 1. è®¾å¤‡ç»Ÿè®¡ä¿¡æ¯
```
é‡‡é›†ç»Ÿè®¡ä¿¡æ¯ï¼š
============================
å›ç¯éŸ³é¢‘å¸§æ•°: 160000
éº¦å…‹é£éŸ³é¢‘å¸§æ•°: 16000
å›ç¯æº¢å‡ºæ¬¡æ•°: 0
éº¦å…‹é£æº¢å‡ºæ¬¡æ•°: 0
å›ç¯é˜Ÿåˆ—å‰©ä½™: 0
éº¦å…‹é£é˜Ÿåˆ—å‰©ä½™: 0
```

#### 2. ç»“æœåˆ¤æ–­
- **æˆåŠŸæ¡ä»¶**ï¼šè‡³å°‘é‡‡é›†åˆ°éŸ³é¢‘æ•°æ®ï¼ˆå¸§æ•° > 0ï¼‰
- **å¤±è´¥æ¡ä»¶**ï¼šæœªé‡‡é›†åˆ°ä»»ä½•éŸ³é¢‘æ•°æ®
- **è­¦å‘Šæƒ…å†µ**ï¼šå­˜åœ¨æº¢å‡ºä½†ä»æœ‰æœ‰æ•ˆæ•°æ®

#### 3. æ—¥å¿—è¾“å‡ºç¤ºä¾‹
```
[WASAPI Loopback] æ—¶é—´: 1.000, éŸ³é‡: 0.0500, æ ·æœ¬æ•°: 480
[éº¦å…‹é£] æ—¶é—´: 1.000, éŸ³é‡: 0.0200, æ ·æœ¬æ•°: 480
```

### è¾“å‡ºä¿¡æ¯å«ä¹‰

| å­—æ®µ | å«ä¹‰ | æ­£å¸¸èŒƒå›´ |
|------|------|----------|
| å›ç¯éŸ³é¢‘å¸§æ•° | ç³»ç»ŸéŸ³é¢‘é‡‡é›†çš„æ€»å¸§æ•° | > 0ï¼ˆå–å†³äºæµ‹è¯•æ—¶é•¿ï¼‰ |
| éº¦å…‹é£éŸ³é¢‘å¸§æ•° | éº¦å…‹é£é‡‡é›†çš„æ€»å¸§æ•° | > 0ï¼ˆå–å†³äºæµ‹è¯•æ—¶é•¿ï¼‰ |
| å›ç¯æº¢å‡ºæ¬¡æ•° | ç³»ç»ŸéŸ³é¢‘ç¼“å†²åŒºæº¢å‡ºæ¬¡æ•° | 0ï¼ˆç†æƒ³çŠ¶æ€ï¼‰ |
| éº¦å…‹é£æº¢å‡ºæ¬¡æ•° | éº¦å…‹é£ç¼“å†²åŒºæº¢å‡ºæ¬¡æ•° | 0ï¼ˆç†æƒ³çŠ¶æ€ï¼‰ |
| éŸ³é‡å€¼ | å½“å‰éŸ³é¢‘çš„ RMS å€¼ | 0.01-0.5ï¼ˆæ­£å¸¸äººå£°èŒƒå›´ï¼‰ |

**ç« èŠ‚æ¥æº**
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py#L169-L184)

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šéŸ³é¢‘è®¾å¤‡æœªè¯†åˆ«

#### ç—‡çŠ¶
```
âš ï¸  æœªæ£€æµ‹åˆ° WASAPI Loopback è®¾å¤‡
è¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ”¯æŒ WASAPIï¼Œä¸” pyaudiowpatch åº“å·²æ­£ç¡®å®‰è£…
```

#### è§£å†³æ–¹æ¡ˆ
1. **æ£€æŸ¥éŸ³é¢‘é©±åŠ¨**
   - æ›´æ–°å£°å¡é©±åŠ¨ç¨‹åº
   - ç¡®è®¤éŸ³é¢‘è®¾å¤‡æ­£å¸¸å·¥ä½œ

2. **éªŒè¯ WASAPI æ”¯æŒ**
   - Windows 10/11 åº”è¯¥åŸç”Ÿæ”¯æŒ WASAPI
   - æ£€æŸ¥éŸ³é¢‘è®¾ç½®ä¸­çš„ WASAPI é€‰é¡¹

3. **é‡æ–°å®‰è£…ä¾èµ–**
   ```bash
   pip uninstall pyaudiowpatch
   pip install pyaudiowpatch>=0.2.12.5
   ```

### é—®é¢˜2ï¼šæƒé™é”™è¯¯

#### ç—‡çŠ¶
```
Permission denied: Access is denied
```

#### è§£å†³æ–¹æ¡ˆ
1. **ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ**
   - å³é”®ç‚¹å‡» `setup_and_test.bat`
   - é€‰æ‹© "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"

2. **æ£€æŸ¥é˜²ç—…æ¯’è½¯ä»¶**
   - æš‚æ—¶ç¦ç”¨å®æ—¶ä¿æŠ¤
   - å°†é¡¹ç›®ç›®å½•æ·»åŠ åˆ°ç™½åå•

3. **ç³»ç»Ÿæƒé™è®¾ç½®**
   - ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰éŸ³é¢‘è®¾å¤‡è®¿é—®æƒé™
   - æ£€æŸ¥ç»„ç­–ç•¥è®¾ç½®

### é—®é¢˜3ï¼šéŸ³é¢‘è®¾å¤‡å†²çª

#### ç—‡çŠ¶
```
Error: Device busy or already in use
```

#### è§£å†³æ–¹æ¡ˆ
1. **å…³é—­å…¶ä»–éŸ³é¢‘åº”ç”¨**
   - å…³é—­æ­£åœ¨ä½¿ç”¨éŸ³é¢‘è®¾å¤‡çš„å…¶ä»–ç¨‹åº
   - åŒ…æ‹¬æµè§ˆå™¨ã€éŸ³ä¹æ’­æ”¾å™¨ç­‰

2. **é‡å¯éŸ³é¢‘æœåŠ¡**
   ```cmd
   net stop audiosrv
   net start audiosrv
   ```

3. **æ›´æ¢è®¾å¤‡**
   - å°è¯•é€‰æ‹©ä¸åŒçš„éŸ³é¢‘è®¾å¤‡
   - ä½¿ç”¨ä¸åŒçš„è¾“å…¥/è¾“å‡ºè®¾å¤‡ç»„åˆ

### é—®é¢˜4ï¼šæµ‹è¯•æ— éŸ³é¢‘è¾“å‡º

#### ç—‡çŠ¶
```
âš ï¸  æœªé‡‡é›†åˆ°éŸ³é¢‘æ•°æ®ï¼Œè¯·æ£€æŸ¥è®¾å¤‡è®¾ç½®
```

#### è§£å†³æ–¹æ¡ˆ
1. **æ’­æ”¾æµ‹è¯•éŸ³é¢‘**
   - åœ¨æµ‹è¯•æœŸé—´æ’­æ”¾éŸ³é¢‘ï¼ˆéŸ³ä¹ã€è§†é¢‘ã€VRChat è¯­éŸ³ï¼‰
   - ç¡®ä¿éŸ³é¢‘è®¾å¤‡æœ‰å®é™…è¾“å‡º

2. **æ£€æŸ¥è®¾å¤‡è¿æ¥**
   - ç¡®è®¤éŸ³é¢‘è®¾å¤‡ç‰©ç†è¿æ¥æ­£å¸¸
   - æ£€æŸ¥éŸ³é‡è®¾ç½®

3. **è°ƒæ•´æµ‹è¯•å‚æ•°**
   - å¢åŠ æµ‹è¯•æ—¶é•¿
   - è°ƒæ•´éŸ³é‡é˜ˆå€¼

**ç« èŠ‚æ¥æº**
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py#L99-L102)
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py#L184-L186)

## æƒé™è¦æ±‚è¯¦è§£

### WASAPI Loopback æƒé™

WASAPI Loopback æ˜¯ Windows ç‰¹æœ‰çš„éŸ³é¢‘æŠ€æœ¯ï¼Œéœ€è¦ç‰¹æ®Šæƒé™æ‰èƒ½è®¿é—®ç³»ç»ŸéŸ³é¢‘è¾“å‡ºï¼š

#### 1. ç®¡ç†å‘˜æƒé™å¿…è¦æ€§
- **ç³»ç»Ÿçº§è®¿é—®**ï¼šWASAPI Loopback éœ€è¦è®¿é—®ç³»ç»ŸéŸ³é¢‘æµ
- **å®‰å…¨é™åˆ¶**ï¼šé˜²æ­¢æ¶æ„è½¯ä»¶çªƒå¬ç³»ç»ŸéŸ³é¢‘
- **é©±åŠ¨ç¨‹åºé™åˆ¶**ï¼šæŸäº›éŸ³é¢‘é©±åŠ¨éœ€è¦ç®¡ç†å‘˜æƒé™

#### 2. æƒé™æ£€æŸ¥æœºåˆ¶
```mermaid
flowchart TD
Start([å¯åŠ¨éŸ³é¢‘é‡‡é›†]) --> CheckAdmin{"æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼Ÿ"}
CheckAdmin --> |å¦| RequestAdmin["è¯·æ±‚æå‡æƒé™"]
CheckAdmin --> |æ˜¯| InitWASAPI["åˆå§‹åŒ– WASAPI"]
RequestAdmin --> AdminSuccess{"æƒé™æå‡æˆåŠŸï¼Ÿ"}
AdminSuccess --> |å¦| PermissionError["æƒé™é”™è¯¯"]
AdminSuccess --> |æ˜¯| InitWASAPI
InitWASAPI --> OpenLoopback["æ‰“å¼€ Loopback æµ"]
OpenLoopback --> StreamOK{"æµåˆ›å»ºæˆåŠŸï¼Ÿ"}
StreamOK --> |å¦| StreamError["æµåˆ›å»ºå¤±è´¥"]
StreamOK --> |æ˜¯| Success["æƒé™éªŒè¯æˆåŠŸ"]
PermissionError --> End([ç»“æŸ])
StreamError --> End
Success --> End
```

**å›¾è¡¨æ¥æº**
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py#L162-L186)

#### 3. æƒé™æå‡æ–¹æ³•
1. **å³é”®èœå•æ–¹å¼**
   - å³é”®ç‚¹å‡» `setup_and_test.bat`
   - é€‰æ‹© "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"

2. **å¿«æ·æ–¹å¼æ–¹å¼**
   - åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶çš„å¿«æ·æ–¹å¼
   - å³é”®å±æ€§ï¼Œé€‰æ‹© "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"

3. **å‘½ä»¤è¡Œæ–¹å¼**
   ```cmd
   powershell -Command "Start-Process 'setup_and_test.bat' -Verb RunAs"
   ```

### å…¶ä»–æƒé™è€ƒè™‘

#### 1. é˜²ç«å¢™è®¾ç½®
- ç¡®ä¿ Python å’Œç›¸å…³åº“çš„ç½‘ç»œè®¿é—®æƒé™
- æŸäº›ä¾èµ–å¯èƒ½éœ€è¦ä¸‹è½½æ›´æ–°

#### 2. é©±åŠ¨ç¨‹åºæƒé™
- éŸ³é¢‘é©±åŠ¨ç¨‹åºå¯èƒ½éœ€è¦ç‰¹æ®Šæƒé™
- æŸäº›ä¸“ä¸šéŸ³é¢‘è®¾å¤‡éœ€è¦ä¸“ç”¨é©±åŠ¨

#### 3. ç³»ç»Ÿç­–ç•¥é™åˆ¶
- ä¼ä¸šç¯å¢ƒå¯èƒ½æœ‰é¢å¤–çš„å®‰å…¨ç­–ç•¥
- å¯èƒ½éœ€è¦è”ç³» IT ç®¡ç†å‘˜

**ç« èŠ‚æ¥æº**
- [setup_and_test.bat](file://setup_and_test.bat#L8-L14)
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py#L162-L186)

## æ•…éšœæ’é™¤æŒ‡å—

### ç³»ç»ŸåŒ–æ’æŸ¥æµç¨‹

```mermaid
flowchart TD
Problem([é‡åˆ°é—®é¢˜]) --> CheckEnv["æ£€æŸ¥ç¯å¢ƒ"]
CheckEnv --> EnvOK{"ç¯å¢ƒæ­£å¸¸ï¼Ÿ"}
EnvOK --> |å¦| FixEnv["ä¿®å¤ç¯å¢ƒé—®é¢˜"]
EnvOK --> |æ˜¯| CheckPerms["æ£€æŸ¥æƒé™"]
CheckPerms --> PermsOK{"æƒé™è¶³å¤Ÿï¼Ÿ"}
PermsOK --> |å¦| ElevatePerms["æå‡æƒé™"]
PermsOK --> |æ˜¯| CheckDevices["æ£€æŸ¥è®¾å¤‡"]
CheckDevices --> DevicesOK{"è®¾å¤‡å¯ç”¨ï¼Ÿ"}
DevicesOK --> |å¦| FixDevices["ä¿®å¤è®¾å¤‡é—®é¢˜"]
DevicesOK --> |æ˜¯| CheckLogs["æŸ¥çœ‹æ—¥å¿—"]
CheckLogs --> LogsOK{"æ—¥å¿—æ­£å¸¸ï¼Ÿ"}
LogsOK --> |å¦| DebugLogs["è°ƒè¯•æ—¥å¿—"]
LogsOK --> |æ˜¯| Success["é—®é¢˜è§£å†³"]
FixEnv --> CheckPerms
ElevatePerms --> CheckDevices
FixDevices --> CheckLogs
DebugLogs --> Success
```

### è¯¦ç»†æ’æŸ¥æ­¥éª¤

#### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒéªŒè¯
1. **Python ç‰ˆæœ¬æ£€æŸ¥**
   ```cmd
   python --version
   ```
   - ç¡®ä¿ç‰ˆæœ¬ >= 3.10
   - æ£€æŸ¥ PATH ç¯å¢ƒå˜é‡

2. **ä¾èµ–å®Œæ•´æ€§æ£€æŸ¥**
   ```cmd
   pip list | findstr pyaudiowpatch
   pip list | findstr numpy
   pip list | findstr scipy
   ```

#### ç¬¬äºŒæ­¥ï¼šæƒé™éªŒè¯
1. **ç®¡ç†å‘˜æƒé™æµ‹è¯•**
   ```cmd
   whoami /priv
   ```
   - æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™
   - ç¡®è®¤ SeDebugPrivilege ç­‰æƒé™

2. **éŸ³é¢‘è®¾å¤‡è®¿é—®æµ‹è¯•**
   ```cmd
   nircmd micspeak 1
   ```
   - æµ‹è¯•éº¦å…‹é£è®¿é—®æƒé™
   - æ£€æŸ¥ç³»ç»ŸéŸ³é¢‘è¾“å‡º

#### ç¬¬ä¸‰æ­¥ï¼šè®¾å¤‡è¯Šæ–­
1. **è®¾å¤‡åˆ—è¡¨æ£€æŸ¥**
   ```cmd
   nircmd devicelist
   ```
   - æŸ¥çœ‹æ‰€æœ‰éŸ³é¢‘è®¾å¤‡
   - ç¡®è®¤è®¾å¤‡çŠ¶æ€

2. **é©±åŠ¨ç¨‹åºéªŒè¯**
   - æ£€æŸ¥è®¾å¤‡ç®¡ç†å™¨
   - æ›´æ–°éŸ³é¢‘é©±åŠ¨ç¨‹åº

#### ç¬¬å››æ­¥ï¼šæ—¥å¿—åˆ†æ
1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   - ä¿®æ”¹æ—¥å¿—çº§åˆ«ä¸º DEBUG
   - è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

2. **å…³é”®æ—¥å¿—ç‚¹**
   - è®¾å¤‡å‘ç°è¿‡ç¨‹
   - æµåˆ›å»ºè¿‡ç¨‹
   - æ•°æ®é‡‡é›†è¿‡ç¨‹

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- è°ƒæ•´ç¼“å†²åŒºå¤§å°
- åŠæ—¶æ¸…ç†éŸ³é¢‘é˜Ÿåˆ—
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ

#### 2. CPU ä½¿ç”¨ä¼˜åŒ–
- é™ä½é‡‡æ ·ç‡ï¼ˆå¦‚ 8kHzï¼‰
- å‡å°‘å¹¶å‘å¤„ç†çº¿ç¨‹
- ä¼˜åŒ–éŸ³é¢‘å¤„ç†ç®—æ³•

#### 3. å»¶è¿Ÿä¼˜åŒ–
- å‡å°ç¼“å†²åŒºå¤§å°
- ä½¿ç”¨æ›´é«˜æ•ˆçš„éŸ³é¢‘æ ¼å¼
- ä¼˜åŒ–å›è°ƒå‡½æ•°æ€§èƒ½

**ç« èŠ‚æ¥æº**
- [tests/test_audio_capture.py](file://tests/test_audio_capture.py#L188-L190)
- [src/audio_capture/audio_capturer.py](file://src/audio_capture/audio_capturer.py#L294-L308)

## æ€»ç»“

é€šè¿‡æœ¬å¿«é€Ÿå…¥é—¨æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

### å®Œæˆçš„ä»»åŠ¡
1. **ç¯å¢ƒæ­å»º**ï¼šæˆåŠŸé…ç½® Python å¼€å‘ç¯å¢ƒ
2. **ä¾èµ–å®‰è£…**ï¼šæ­£ç¡®å®‰è£…æ‰€æœ‰å¿…è¦çš„ Python åŒ…
3. **æƒé™è®¾ç½®**ï¼šç†è§£å¹¶è§£å†³ WASAPI Loopback æƒé™é—®é¢˜
4. **è®¾å¤‡é…ç½®**ï¼šç†Ÿç»ƒé€‰æ‹©å’Œé…ç½®éŸ³é¢‘è®¾å¤‡
5. **åŠŸèƒ½éªŒè¯**ï¼šæˆåŠŸè¿è¡ŒéŸ³é¢‘é‡‡é›†æµ‹è¯•

### é¢„æœŸç»“æœ
- **æˆåŠŸæ¡ˆä¾‹**ï¼šæµ‹è¯•æ˜¾ç¤ºé‡‡é›†åˆ°éŸ³é¢‘æ•°æ®ï¼Œå¸§æ•° > 0
- **å¤±è´¥æ¡ˆä¾‹**ï¼šæ˜ç¡®çš„é—®é¢˜åŸå› å’Œè§£å†³æ–¹æ¡ˆ
- **æ€§èƒ½æŒ‡æ ‡**ï¼šä½å»¶è¿Ÿã€é«˜ç¨³å®šæ€§éŸ³é¢‘é‡‡é›†

### åç»­æ­¥éª¤
1. **æ·±å…¥å­¦ä¹ **ï¼šç ”ç©¶ `src/audio_capture/` ç›®å½•ä¸‹çš„æ ¸å¿ƒä»£ç 
2. **åŠŸèƒ½æ‰©å±•**ï¼šåŸºäºæµ‹è¯•ç»“æœè¿›è¡ŒåŠŸèƒ½å®šåˆ¶
3. **ç”Ÿäº§éƒ¨ç½²**ï¼šå°†éŸ³é¢‘é‡‡é›†åŠŸèƒ½é›†æˆåˆ° VRChat ç¤¾äº¤åŠ©æ‰‹é¡¹ç›®ä¸­

### æ³¨æ„äº‹é¡¹
- **å®šæœŸæ›´æ–°**ï¼šä¿æŒä¾èµ–åº“ä¸ºæœ€æ–°ç¨³å®šç‰ˆæœ¬
- **æƒé™ç®¡ç†**ï¼šè°¨æ…å¤„ç†ç®¡ç†å‘˜æƒé™
- **è®¾å¤‡å…¼å®¹**ï¼šæµ‹è¯•ä¸åŒéŸ³é¢‘è®¾å¤‡çš„å…¼å®¹æ€§
- **æ€§èƒ½ç›‘æ§**ï¼šæŒç»­ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

é€šè¿‡éµå¾ªæœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨ 5 åˆ†é’Ÿå†…å®ŒæˆåŸºæœ¬çš„ç¯å¢ƒéªŒè¯ï¼Œå¹¶åœ¨ 30 åˆ†é’Ÿå†…æŒæ¡éŸ³é¢‘é‡‡é›†çš„æ ¸å¿ƒåŠŸèƒ½ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—æˆ–å¯»æ±‚ç¤¾åŒºæ”¯æŒã€‚